<h1 class="text-center my-4">Items Management</h1>
<div class="container-fluid px-4 mt-3">
  <div class="card mb-4 mt-3">
    <div class="card-header">
      <table class="table table-striped table-hover border rounded mt-2">
        <thead class="table-dark text-center">
        <tr>
          <th>Image</th>
          <th>Name</th>
          <th>Quantity</th>
          <th>Min Tickets</th>
          <th>Status</th>
          <th>State</th>
          <th>Offline At</th>
          <th>Online At</th>
          <th>Category</th>
          <th>Actions</th>
          <th>State actions</th>
        </tr>
        </thead>
        <tbody>
        <% @items.each do |item| %>
          <tr>
            <td class="text-center align-middle">
              <%= image_tag item.image.url, width: 80, height: 80, class: "rounded border" if item.image? %>
            </td>
            <td class="text-center align-middle"><%= item.name %></td>
            <td class="text-center align-middle"><%= item.quantity %></td>
            <td class="text-center align-middle"><%= item.minimum_tickets %></td>
            <td class="text-center align-middle">
  <span class="badge bg-<%= item.status.present? && item.status == 'active' ? 'success' : 'secondary' %>">
    <%= item.status.present? ? item.status.capitalize : 'N/A' %>
  </span>
            </td>
            <td class="text-center align-middle">
  <span class="badge bg-<%= item.state == 'starting' ? 'success' : 'secondary' %>">
    <%= item.state.present? ? item.state.capitalize : 'N/A' %>
  </span>
            </td>
            <td class="text-center align-middle">
              <%= item.offline_at&.strftime("%Y/%m/%d %I:%M %p") %>
            </td>
            <td class="text-center align-middle">
              <%= item.online_at&.strftime("%Y/%m/%d %I:%M %p") %>
            </td>
            <td class="text-center align-middle">
              <%= item.categories.map(&:name).join(", ") if item.categories.any? %>
            </td>

            <td class="text-center align-middle">
              <div class="btn-group gap-1" role="group" >
                <%= link_to 'View', admin_item_path(item), class: "btn btn-outline-secondary btn-sm " %>
                <%= link_to 'Edit', edit_admin_item_path(item), class: 'btn btn-outline-success btn-sm' %>
                <%= button_to 'Delete', admin_item_path(item), method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-outline-danger btn-sm' %>
              </div>
            </td>

            <td class="text-center align-middle">
              <div class="btn-group gap-1" role="group">
                <% if item.may_start? %>
                  <%= button_to 'Start', start_admin_item_path(item), method: :patch, class: 'btn btn-light btn-sm' %>
                <% end %>
                <% if item.may_pause? %>
                  <%= button_to 'Pause', pause_admin_item_path(item), method: :patch, class: 'btn btn-light btn-sm' %>
                <% end %>
                <% if item.may_end? %>
                  <%= button_to 'End', end_admin_item_path(item), method: :patch, class: 'btn btn-light btn-sm' %>
                <% end %>
                <% if item.may_cancel? %>
                  <%= button_to 'Cancel', cancel_admin_item_path(item), method: :patch, class: 'btn btn-light btn-sm' %>
                <% end %>
              </div>
          </tr>
        <% end %>
        </tbody>
      </table>
      <div class="d-flex justify-content-end mb-3 ">
        <%= link_to 'New Item', new_admin_item_path, class: 'btn btn-dark me-2' %>
        <%= link_to 'Back', admin_session_path, class: 'btn btn-light' %>
      </div>
    </div>
  </div>
</div>

